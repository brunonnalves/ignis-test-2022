import { Avatar, CardHeader, CardMedia, IconButton, InputAdornment, OutlinedInput, Typography } from "@mui/material"
import SearchIcon from '@mui/icons-material/Search'
import Head from "next/head"
import React, { useEffect, useState } from "react"
import HeaderDefault from "../../components/HeaderDefault/HeaderDefault"
import { MovieCard, MovieCardOverview, MovieCardTitle, MoviesCardContainer, MoviesContainer, MoviesFormStyled, MoviesMainContainer, MoviesPageContainer, SearchContainer, WelcomeContainer } from "./styles"
import { NextPage } from "next"
import { getMoviesService } from "../../services"
import { IMovies } from "../../services/getMovies/types"
import ButtonDefault from "../../components/ButtonDefault/ButtonDefault"
import { red } from "@mui/material/colors"


const MoviesPage: NextPage = () => {
  const [movies, setMovies] = useState<IMovies[]>([])
  const [user, setUser] = useState('');
  useEffect(() => setUser(JSON.parse(localStorage.getItem('user') ?? '')), []);
  console.log(user)

  useEffect(() => { handleGetMovies() }, []);

  const handleGetMovies = async () => {
    try {
      const { results } = await getMoviesService.getMovies()
      setMovies(results)
    } catch (error) {
      console.log(error)
    }
  }

  return (
    <>
      <MoviesPageContainer>
        <Head>
          <title>IgnisFlix | Movies</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <MoviesMainContainer>
          <HeaderDefault isIconExists={true} />

          <WelcomeContainer><span>Bem vindo, </span>{user.name}</WelcomeContainer>
          <SearchContainer>

            <MoviesFormStyled>
              <OutlinedInput
                placeholder="Buscar filme"
                endAdornment={
                  <InputAdornment position="end">
                    <IconButton
                      type="button"
                      edge="end"
                    >
                      <SearchIcon />
                    </IconButton>
                  </InputAdornment>}
              />

            </MoviesFormStyled>
          </SearchContainer>

          <MoviesContainer>
            <h1>Filmes</h1>
            <MoviesCardContainer>
              {movies.map(movie => (
                <MovieCard>
                  <CardMedia
                    component="img"
                    height="230"
                    image={movie.poster_path}
                    alt="green iguana"
                  />
                  <CardHeader
                    avatar={
                      <Avatar sx={{ bgcolor: red[500] }} aria-label="recipe">
                        {movie.popularity}
                      </Avatar>
                    }
                  />
                  <MovieCardTitle>
                    {movie.title}
                  </MovieCardTitle>
                  <MovieCardOverview>
                    {movie.overview}
                  </MovieCardOverview>
                </MovieCard>
              ))}

            </MoviesCardContainer>
          </MoviesContainer>

          <ButtonDefault text="Ver mais" onClick={() => { console.log('clicou') }} />

        </MoviesMainContainer>
      </MoviesPageContainer>
    </>
  )
}

export default MoviesPage;